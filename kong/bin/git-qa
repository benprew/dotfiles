#!/bin/bash

set -e
set -x

branch=$1
server=$2

if [[ $branch == "" || $server == "" ]]; then
    echo Usage: git-qa BRANCH SERVER
    exit 1
fi

if [[ $branch == "HEAD" ]]; then
    branch=`git symbolic-ref --short HEAD`
fi

git push origin $branch
git checkout qa_review
git fetch origin
git reset --hard origin/qa_review
git merge $branch
git push origin qa_review
~/.rvm/rubies/ruby-1.9.1-p431/bin/ruby ~/.rvm/gems/ruby-1.9.1-p431/gems/capistrano-2.13.3/bin/cap ${server}_deploy
marginalia append 401 deployed $branch to $server